//TODO: wrap in module!!
$(function(){
  var init = function () {
    var icons = {
      "angellist"  : {
        "url"  : "https://angel.co/<%= user %>",
        "color": "black",
        "path" : "M65.537,109.687c-0.728-1.919-1.853-4.832-1.853-6.884c0-5.428,6.685-12.18,12.113-12.18c1.589,0,3.178,0.463,4.634,0.993c-2.78-7.876-10.789-30.051-10.789-37.53c0-6.686,3.376-11.981,10.591-11.981c9.267,0,19.791,33.361,22.042,39.98c2.912-7.281,12.047-37.796,22.373-37.796c6.486,0,10.127,5.163,10.127,11.319c0,7.016-7.811,28.86-10.525,36.406c11.12,2.714,12.709,11.716,12.709,21.711c0,26.477-16.879,46.996-44.216,46.996c-5.03,0-9.995-0.993-14.761-2.78c-12.576-4.766-24.292-17.673-24.292-31.639C53.689,117.696,56.998,112.004,65.537,109.687z M62.889,132.589c5.229,12.908,17.011,20.453,30.779,20.453c10.061,0,18.534-3.839,25.285-11.252c7.149-7.943,10.061-17.74,10.061-28.265c0-3.706,0.066-9.597-2.846-12.245c-5.56-4.898-24.425-6.751-31.904-6.751c-0.927,0-2.516,0.066-3.244,0.728c-0.795,0.331-0.795,1.589-0.795,2.317c0,10.127,21.38,9.201,27.8,9.201c1.258,0,1.853,0.331,2.648,1.257c0.86,1.059,1.125,2.317,1.257,3.641c-1.721,1.721-4.104,2.713-6.354,3.574c-2.184,0.794-4.302,1.655-6.156,3.045c-5.097,3.706-10.127,10.061-10.127,16.614c0,4.104,2.449,7.613,2.449,11.65c0,0.066-0.463,1.522-0.463,1.721c-7.546-0.529-9.399-8.009-9.664-14.298c-0.794,0.199-1.853,0.133-2.713,0.133c0.132,0.463,0.132,0.927,0.132,1.39c0,4.832-4.302,8.34-8.936,8.34c-7.148,0-16.614-8.406-16.614-15.687c0-1.986,0.86-3.112,2.184-4.435c1.324,1.655,2.714,3.31,3.972,5.03c1.919,2.581,5.229,6.884,8.803,6.884c0.927,0,2.714-0.794,2.714-1.919c0-2.978-10.855-16.945-13.504-16.945c-4.17,0-6.42,5.494-6.42,8.936C61.235,128.088,62.029,130.405,62.889,132.589z M89.498,126.169c1.324,0,2.45-1.456,2.45-2.647c0-1.523-1.523-5.296-2.118-6.752c-1.722-4.435-8.009-18.137-13.437-18.137c-1.788,0-4.7,3.111-4.7,4.898C71.693,108.364,84.667,126.169,89.498,126.169z M87.447,87.778c0.926-0.529,2.118-0.662,3.243-0.662c1.589,0,3.376,0.199,4.964,0.331l-8.009-23.234c-0.86-2.516-4.7-14.562-8.141-14.562c-1.788,0-2.582,2.118-2.582,3.641C76.922,60.043,84.932,81.093,87.447,87.778z M98.434,118.425c1.456-1.655,2.979-3.177,4.7-4.435c-2.317-0.463-4.633-0.661-6.884-1.389C96.978,114.52,97.772,116.439,98.434,118.425z M108.496,88.837l7.745,1.389c1.985-5.428,10.921-29.852,10.921-34.287c0-1.655-0.529-3.707-2.515-3.707c-3.707,0-7.679,12.047-8.605,14.893L108.496,88.837z"
      },
      "behance"    : {
        "url"  : "https://www.behance.net/<%= user %>",
        "color": "#1769ff",
        "path" : "M80.735,65.674c11.769,0,21.957,3.324,21.957,16.999c0,6.92-3.214,11.387-9.372,14.33c8.446,2.398,12.532,8.772,12.532,17.381c0,13.948-11.714,19.941-24.192,19.941H48.369V65.674H80.735z M78.772,93.407c5.394,0,9.209-2.343,9.209-8.173c0-6.32-4.903-7.845-10.352-7.845H63.462v16.019H78.772z M79.59,122.665c6.156,0,11.169-2.18,11.169-9.099c0-7.029-4.194-9.808-10.843-9.808H63.462v18.907H79.59z M146.991,118.905h12.042c-3.706,11.387-11.389,16.727-23.266,16.727c-15.693,0-25.446-10.625-25.446-26.098c0-14.929,10.297-26.316,25.446-26.316c15.583,0,24.192,12.259,24.192,26.97c0,0.872-0.054,1.744-0.109,2.561h-35.853c0,7.955,4.196,12.641,12.206,12.641C140.342,125.389,145.682,123.155,146.991,118.905z M121.218,70.305v6.756h27.843v-6.756H121.218z M123.996,104.14h22.232c-0.6-6.593-4.033-10.625-10.899-10.625C128.792,93.516,124.432,97.602,123.996,104.14z"
      },
      "deviantart" : {
        "url"  : "http://<%= user %>.deviantart.com",
        "color": "#cc2127",
        "path" : "M146.289,62.089v75.823c0,4.641-3.737,8.378-8.379,8.378H62.089c-4.641,0-8.379-3.737-8.379-8.378V62.089c0-4.641,3.737-8.378,8.379-8.378h75.821C142.552,53.711,146.289,57.447,146.289,62.089z M142.01,62.089c0-2.23-1.868-4.098-4.099-4.098H62.089c-2.231,0-4.099,1.869-4.099,4.098v75.823c0,2.23,1.868,4.098,4.099,4.098h75.821c2.231,0,4.099-1.869,4.099-4.098V62.089z M138.996,62.089v25.796c-3.616-1.265-7.413-2.29-11.331-3.134c-12.236-2.652-25.376-2.713-38.876-0.724c-0.482,0.121-0.604,0.121-1.086,0.181l-3.918-8.076H69.743l5.123,11.451c-5.424,2.11-10.065,4.942-13.862,8.258V62.089c0-0.603,0.482-1.085,1.086-1.085h75.821C138.514,61.004,138.996,61.486,138.996,62.089z M106.871,116.756l32.125-8.74v29.896c0,0.603-0.482,1.085-1.086,1.085H62.089c-0.604,0-1.086-0.482-1.086-1.085v-8.499l42.854-11.753L91.079,91.2c0.482-0.06,0.964-0.181,1.447-0.241c20.913-3.737,33.812,0.422,40.262,7.172c1.446,1.507-0.122,2.17-1.508,2.532c0,0-3.857,0.965-15.43,3.737l-5.847-11.934c-4.098-0.241-8.919,0-14.464,0.964L106.871,116.756z M68.538,113.682c-0.784-6.63,1.024-13.561,10.005-18.383l7.775,16.274l-15.37,3.677C69.864,115.49,68.719,114.827,68.538,113.682z"
      },
      "facebook"   : {
        "url"  : "https://facebook.com/<%= user %>",
        "color": "#3b5998",
        "path" : "M121.44,60.431h-11.054c-8.661,0-10.28,4.154-10.28,10.138v13.307h20.63l-2.746,20.841h-17.884v53.439H78.56v-53.439H60.607V83.876H78.56V68.528c0-17.813,10.914-27.53,26.826-27.53c7.604,0,14.152,0.563,16.053,0.845V60.431z"
      },
      "flickr"     : {
        "url"    : "https://www.flickr.com/photos/<%= user %>/",
        "color"  : "black",
        "path"   : "M149.251,69.218v61.564c0,10.197-8.272,18.469-18.469,18.469H69.218c-10.197,0-18.469-8.272-18.469-18.469V69.218c0-10.197,8.272-18.469,18.469-18.469h61.564C140.979,50.749,149.251,59.021,149.251,69.218z",
        "circles": [
          {
            "path"    : "M118.084,86.404c-7.503,0-13.595,6.093-13.595,13.596s6.092,13.596,13.595,13.596S131.68,107.503,131.68,100S125.588,86.404,118.084,86.404z",
            "color"   : "#ff0084",
            "inverted": "#ff80c2"
          },
          {
            "path"    : "M81.916,86.404c-7.503,0-13.596,6.093-13.596,13.596s6.093,13.596,13.596,13.596S95.511,107.503,95.511,100S89.419,86.404,81.916,86.404z",
            "color"   : "#0063dc",
            "inverted": "#6ea0dc"
          }
        ]
      },
      "github"     : {
        "url"  : "https://github.com/<%= user %>",
        "color": "#333333",
        "path" : "M119.617,158.852c-3.148,0.565-4.197-1.373-4.197-2.987c0-2.018,0-8.719,0-17.035c0-5.812-1.938-9.526-4.198-11.464c13.805-1.534,28.336-6.781,28.336-30.596c0-6.782-2.422-12.352-6.377-16.63c0.646-1.615,2.744-7.912-0.647-16.469c-5.167-1.614-17.034,6.378-17.034,6.378c-4.924-1.373-10.253-2.1-15.5-2.1c-5.247,0-10.576,0.727-15.5,2.1c0,0-11.867-7.992-17.115-6.378c-3.309,8.557-1.211,14.854-0.565,16.469c-3.955,4.279-6.377,9.849-6.377,16.63c0,23.734,14.451,29.062,28.256,30.596c-1.777,1.615-3.391,4.279-3.956,8.315c-3.553,1.615-12.594,4.36-18.003-5.167c-3.391-5.893-9.526-6.377-9.526-6.377c-6.055-0.08-0.403,3.794-0.403,3.794c4.036,1.857,6.861,9.042,6.861,9.042c3.633,11.059,20.909,7.346,20.909,7.346c0,5.167,0.081,10.092,0.081,11.545c0,1.614-1.13,3.552-4.279,2.987C55.761,150.617,38,127.367,38,100c0-34.229,27.771-62,62-62s62,27.771,62,62C162,127.367,144.239,150.617,119.617,158.852z"
      },
      "google-plus": {
        "url"  : "https://plus.google.com/+<%= user %>/",
        "color": "#dd4b39",
        "path" : "M122.951,128.134c0,4.104-1.21,8.14-3.228,11.638c-6.931,11.774-21.396,15.945-34.248,15.945c-10.092,0-22.54-2.624-28.125-12.042c-1.614-2.624-2.489-5.719-2.489-8.813c0-7.602,4.71-13.926,10.967-17.828c7.872-4.911,18.099-6.122,27.182-6.727c-2.354-3.095-4.238-5.853-4.238-9.889c0-2.153,0.605-3.835,1.413-5.719c-1.548,0.134-3.028,0.269-4.575,0.269c-13.12,0-23.617-9.553-23.617-22.941c0-7.4,3.498-14.666,9.083-19.509c7.266-6.257,17.561-8.746,26.913-8.746h28.125l-9.284,5.92h-8.815c6.257,5.315,10.092,11.235,10.092,19.711c0,17.425-15.946,19.375-15.946,27.92C102.161,106.202,122.951,109.162,122.951,128.134z M113.397,133.852c0-9.082-9.016-14.599-15.542-19.308c-1.077-0.135-2.153-0.135-3.23-0.135c-10.967,0-27.25,3.499-27.25,17.357c0,13.119,14.197,17.828,25.097,17.828C102.43,149.594,113.397,145.423,113.397,133.852z M102.026,86.826c2.759-2.96,3.566-6.727,3.566-10.697c0-9.956-5.853-26.843-17.964-26.843c-3.768,0-7.67,1.884-9.958,4.844c-2.422,3.028-3.162,6.997-3.162,10.764c0,10.091,5.719,25.969,17.83,25.969C95.702,90.863,99.671,89.248,102.026,86.826z M161.302,90.661v7.265h-14.33v14.734h-7.065V97.926h-14.264v-7.265h14.264V76.062h7.065v14.599H161.302z"
      },
      "instagram"  : {
        "url"  : "http://instagram.com/<%= user %>",
        "color": "#3f729b",
        "path" : "M147.422,135.258c0,6.668-5.495,12.164-12.164,12.164H64.742c-6.668,0-12.164-5.495-12.164-12.164V64.742c0-6.668,5.495-12.164,12.164-12.164h70.516c6.668,0,12.164,5.495,12.164,12.164V135.258z M136.678,92.714h-8.336c0.803,2.531,1.235,5.31,1.235,8.089c0,15.807-13.214,28.589-29.516,28.589c-16.24,0-29.453-12.782-29.453-28.589c0-2.779,0.432-5.558,1.235-8.089h-8.707v40.012c0,2.1,1.667,3.766,3.766,3.766h66.008c2.099,0,3.766-1.667,3.766-3.766V92.714z M100.062,81.352c-10.497,0-19.018,8.274-19.018,18.462c0,10.189,8.521,18.462,19.018,18.462c10.559,0,19.08-8.274,19.08-18.462C119.142,89.627,110.62,81.352,100.062,81.352z M136.678,67.398c0-2.347-1.914-4.261-4.26-4.261h-10.744c-2.347,0-4.261,1.914-4.261,4.261v10.188c0,2.347,1.914,4.26,4.261,4.26h10.744c2.346,0,4.26-1.914,4.26-4.26V67.398z"
      },
      "lastfm"     : {
        "url"  : "http://www.last.fm/user/<%= user %>",
        "color": "#c3000d",
        "path" : "M127.031,80.015c1.843,5.598,6.144,6.757,11.263,8.191c11.401,3.208,22.186,9.285,22.186,22.664c0,13.585-11.331,23.141-24.576,23.141c-21.981,0-28.807-26.896-35.155-43.279C95.493,77.216,89.964,69.297,74.74,69.297c-13.515,0-25.394,12.971-25.394,26.282c0,14.13,10.581,27.237,25.258,27.237c6.484,0,13.243-1.366,17.612-6.485c2.117-2.389,4.165-4.983,5.666-7.918l5.734,10.376c-0.752,1.707-1.843,3.345-3.003,4.779l0.068,0.068c-6.894,7.987-16.316,10.376-26.487,10.376c-20.615,0-36.043-18.226-36.043-38.296c0-19.455,16.93-37.545,36.589-37.545c32.631,0,34.269,28.261,45.328,50.993c3.003,6.28,8.122,13.653,15.906,13.653c7.098,0,13.379-4.574,13.379-12.083c0-16.247-29.831-5.188-34.063-31.879c-0.136-0.751-0.206-1.502-0.206-2.253c0-10.103,9.489-18.772,19.525-18.431c6.007,0.204,9.626,0.409,14.403,4.642h-0.068c1.843,1.707,3.209,4.027,4.643,6.007l-8.806,6.758c-1.024-1.911-1.98-3.481-3.687-4.778V70.73c-1.638-1.502-4.573-1.434-6.622-1.434c-4.437,0-8.122,3.345-8.122,7.919C126.349,77.626,126.895,79.537,127.031,80.015z"
      },
      "linkedin"   : {
        "url"  : "http://www.linkedin.com/in/<%= user %>",
        "color": "#0976b4",
        "path" : "M149.251,130.782c0,10.197-8.272,18.469-18.469,18.469H69.218c-10.197,0-18.469-8.272-18.469-18.469V69.218c0-10.197,8.272-18.469,18.469-18.469h61.564c10.197,0,18.469,8.272,18.469,18.469V130.782z M73.451,67.294c-5.067,0-8.401,3.334-8.401,7.695c0,4.233,3.206,7.696,8.209,7.696h0.064c5.195,0,8.401-3.463,8.401-7.696C81.659,70.629,78.517,67.294,73.451,67.294z M80.761,133.219V88.713H65.947v44.507H80.761z M134.052,133.219v-25.524c0-13.66-7.311-20.009-17.058-20.009c-7.952,0-11.48,4.425-13.403,7.503h0.128v-6.478H88.905c0,0,0.193,4.169,0,44.507h14.814v-24.882c0-1.283,0.065-2.63,0.449-3.591c1.09-2.63,3.528-5.387,7.632-5.387c5.322,0,7.439,4.04,7.439,10.068v23.793H134.052z"
      },
      "pinterest"  : {
        "url"  : "http://pinterest.com/<%= user %>",
        "color": "#cc2127",
        "path" : "M100,162c-6.135,0-11.948-0.888-17.599-2.583c2.341-3.714,5.005-8.477,6.297-13.239c0,0,0.726-2.745,4.359-17.034c2.099,4.117,8.396,7.75,15.096,7.75c19.941,0,33.503-18.165,33.503-42.545c0-18.326-15.58-35.52-39.315-35.52c-29.385,0-44.239,21.15-44.239,38.75c0,10.656,4.036,20.182,12.674,23.734c1.373,0.565,2.664,0,3.068-1.614c0.323-1.05,0.968-3.795,1.291-4.925c0.404-1.614,0.242-2.099-0.888-3.471c-2.502-2.987-4.117-6.781-4.117-12.19c0-15.662,11.706-29.709,30.515-29.709c16.63,0,25.833,10.172,25.833,23.815c0,17.842-7.911,32.938-19.697,32.938c-6.459,0-11.303-5.328-9.768-11.947c1.856-7.831,5.489-16.307,5.489-21.959c0-5.086-2.745-9.365-8.397-9.365c-6.62,0-11.947,6.862-11.947,16.065c0,0,0,5.894,2.018,9.85c-6.782,28.739-7.992,33.744-7.992,33.744c-1.13,4.683-1.211,9.93-1.05,14.289C53.258,147.227,38,125.43,38,100c0-34.229,27.771-62,62-62s62,27.771,62,62S134.229,162,100,162z"
      },
      "reddit"     : {
        "url"  : "http://www.reddit.com/user/<%= user %>",
        "color": "orangered",
        "path" : "M160.113,107.69c0-7.553-6.103-13.656-13.656-13.656c-3.504,0-6.706,1.33-9.124,3.505c-9.184-5.982-21.088-9.486-33.838-10.031l7.01-22.115l19.033,4.472c0.06,6.163,5.076,11.178,11.239,11.178c6.223,0,11.239-5.076,11.239-11.3c0-6.163-5.016-11.239-11.239-11.239c-4.593,0-8.58,2.78-10.332,6.768l-20.967-4.955c-1.209-0.242-2.416,0.423-2.779,1.572l-8.097,25.559c-13.475,0.242-26.104,3.746-35.771,9.909c-2.418-2.055-5.559-3.324-8.943-3.324c-7.554,0-13.656,6.103-13.656,13.656c0,4.834,2.598,9.124,6.405,11.541c-0.182,1.329-0.303,2.658-0.303,3.988c0,9.789,5.68,18.852,16.074,25.62c10.03,6.586,23.383,10.212,37.523,10.212s27.433-3.626,37.523-10.212c10.332-6.767,16.074-15.831,16.074-25.62c0-1.208-0.122-2.477-0.303-3.686C157.334,117.176,160.113,112.766,160.113,107.69z M73.767,116.753c0-4.592,3.867-8.399,8.4-8.399c4.531,0,8.278,3.807,8.278,8.399c0,4.532-3.747,8.217-8.278,8.217C77.634,124.971,73.767,121.285,73.767,116.753z M119.507,139.668c-4.048,4.049-10.332,5.332-19.274,5.332h-0.122c-8.942,0-15.226-1.283-19.275-5.332c-0.906-0.906-0.906-2.092,0-2.999c0.908-0.906,2.357-1.068,3.263-0.161c3.142,3.142,8.339,4.492,16.012,4.492h0.122c7.612,0,12.87-1.187,16.012-4.329c0.906-0.906,2.356-1.069,3.262-0.163C120.415,137.415,120.415,138.762,119.507,139.668z M118.3,124.971c-4.532,0-8.4-3.686-8.4-8.217c0-4.592,3.867-8.399,8.4-8.399c4.531,0,8.278,3.807,8.278,8.399C126.578,121.285,122.831,124.971,118.3,124.971z"
      },
      "soundcloud" : {
        "url"  : "https://soundcloud.com/<%= user %>",
        "color": "#ff8800",
        "path" : "M40.962,100.484l-1.077,6.781c-0.054,0.269-0.216,0.484-0.484,0.484c-0.269,0-0.43-0.215-0.485-0.484l-0.914-6.781l0.914-6.889c0.055-0.269,0.216-0.484,0.485-0.484c0.268,0,0.43,0.215,0.484,0.484L40.962,100.484z M45.914,100.484l-1.4,10.925c-0.054,0.269-0.269,0.485-0.538,0.485c-0.269,0-0.485-0.215-0.485-0.538l-1.238-10.871c1.238-11.14,1.238-11.14,1.238-11.14c0-0.269,0.216-0.485,0.485-0.485c0.268,0,0.484,0.215,0.538,0.485L45.914,100.484z M50.81,100.484l-1.345,12.755c0,0.322-0.269,0.592-0.593,0.592c-0.322,0-0.591-0.269-0.645-0.592l-1.13-12.755l1.13-13.185c0.054-0.377,0.323-0.646,0.645-0.646c0.323,0,0.593,0.269,0.593,0.646L50.81,100.484z M55.761,100.484l-1.238,13.132c-0.054,0.43-0.377,0.699-0.753,0.699c-0.377,0-0.7-0.269-0.7-0.699l-1.13-13.132l1.13-13.562c0-0.43,0.323-0.699,0.7-0.699c0.377,0,0.7,0.269,0.753,0.699L55.761,100.484z M60.713,100.484l-1.13,13.239c-0.054,0.485-0.43,0.861-0.861,0.861s-0.807-0.377-0.807-0.861l-1.077-13.239l1.077-12.593c0-0.43,0.377-0.807,0.807-0.807s0.807,0.377,0.861,0.807L60.713,100.484z M65.772,100.484l-1.13,13.239c0,0.538-0.432,0.969-0.916,0.969c-0.538,0-0.914-0.43-0.968-0.969l-0.969-13.239c0.969-20.451,0.969-20.451,0.969-20.451c0.054-0.538,0.43-0.969,0.968-0.969c0.484,0,0.916,0.43,0.916,0.969L65.772,100.484z M70.724,100.592l-1.023,13.131c0,0.592-0.484,1.023-1.023,1.023c-0.591,0-1.023-0.431-1.077-1.023l-0.861-13.131c0.861-25.187,0.861-25.187,0.861-25.187c0.054-0.592,0.485-1.022,1.077-1.022c0.539,0,1.023,0.43,1.023,1.022L70.724,100.592z M75.943,100.484l-0.968,13.024c-0.055,0.646-0.539,1.13-1.184,1.13c-0.593,0-1.077-0.484-1.13-1.13l-0.862-13.024l0.862-27.232c0-0.646,0.538-1.184,1.13-1.184c0.645,0,1.129,0.538,1.184,1.184L75.943,100.484z M81.055,100.484l-0.861-28.147c-0.054-0.7-0.591-1.292-1.291-1.292c-0.646,0-1.238,0.592-1.238,1.292l-0.753,28.147l0.753,12.97c0.054,0.7,0.591,1.238,1.238,1.238c0.7,0,1.237-0.538,1.291-1.238L81.055,100.484z M86.223,100.484l-0.807,12.862c0,0.753-0.593,1.345-1.346,1.345s-1.291-0.592-1.345-1.345l-0.753-12.862l0.753-27.447c0-0.753,0.591-1.345,1.345-1.345s1.346,0.592,1.346,1.345L86.223,100.484z M91.497,100.538l-0.753,12.701c0,0.807-0.646,1.453-1.453,1.453s-1.453-0.646-1.507-1.453l-0.646-12.701l0.646-26.478c0.054-0.861,0.7-1.507,1.507-1.507s1.4,0.646,1.453,1.507L91.497,100.538z M96.717,100.538l-0.645-31.537c0-0.538-0.269-1.023-0.7-1.292c-0.269-0.162-0.539-0.269-0.861-0.269c-0.323,0-0.593,0.108-0.862,0.269c-0.43,0.269-0.699,0.753-0.699,1.292l-0.055,0.322l-0.538,31.161c0,0,0,0.054,0.593,12.701c0,0,0,0,0,0.054c0,0.322,0.107,0.646,0.322,0.915c0.323,0.377,0.753,0.592,1.239,0.592c0.43,0,0.807-0.215,1.075-0.485c0.323-0.269,0.485-0.646,0.485-1.077l0.054-1.291L96.717,100.538z M101.4,112.97c0,0.915-0.753,1.669-1.669,1.669c-0.914,0-1.668-0.753-1.722-1.669l-0.323-6.135l-0.323-6.297l0.646-34.228v-0.162c0.054-0.485,0.269-0.969,0.645-1.292c0.269-0.215,0.646-0.377,1.077-0.377c0.269,0,0.593,0.107,0.807,0.269c0.485,0.269,0.808,0.808,0.862,1.4l0.753,34.389L101.4,112.97z M146.767,114.692c-42.246,0-42.3,0-42.3,0c-0.916-0.107-1.669-0.807-1.669-1.776V64.534c0-0.915,0.323-1.345,1.507-1.776c2.96-1.184,6.297-1.83,9.742-1.83c14.046,0,25.564,10.764,26.801,24.487c1.83-0.753,3.821-1.184,5.919-1.184c8.396,0,15.231,6.835,15.231,15.284C161.998,107.911,155.163,114.692,146.767,114.692z"
      },
      "spotify"    : {
        "url"  : "http://open.spotify.com/user/<%= user %>",
        "color": "#7ab800",
        "path" : "M157.115,85.356c-19.051-11.12-45.145-16.295-70.03-16.295c-14.645,0-28.078,1.651-40.079,5.175c-3.083,0.88-5.947,3.523-5.947,8.148c0,4.514,3.415,8.037,7.927,8.037c1.654,0,3.196-0.55,4.405-0.881c10.681-2.972,22.241-4.073,33.803-4.073c22.902,0,46.687,5.065,61.99,14.204c1.542,0.881,2.644,1.321,4.405,1.321c4.183,0,7.927-3.303,7.927-7.927C161.518,88.991,159.757,86.898,157.115,85.356z M145.772,113.655c-16.845-10.02-38.208-15.526-60.339-15.526c-14.204,0-23.895,1.982-33.364,4.625c-3.522,0.99-5.283,3.414-5.283,7.047c0,3.633,2.971,6.607,6.605,6.607c1.542,0,2.422-0.44,4.073-0.882c7.708-2.092,16.958-3.633,27.639-3.633c20.919,0,39.969,5.505,53.731,13.654c1.212,0.661,2.422,1.432,4.186,1.432c3.742,0,6.605-2.973,6.605-6.607C149.626,117.398,148.526,115.306,145.772,113.655z M135.752,138.429c-14.204-8.479-30.72-12.662-49.219-12.662c-10.789,0-21.141,1.431-31.6,3.743c-2.532,0.551-4.625,2.203-4.625,5.726c0,2.753,2.093,5.396,5.396,5.396c0.99,0,2.754-0.551,4.073-0.882c8.589-1.761,17.619-2.972,26.756-2.972c16.187,0,31.493,3.964,43.713,11.341c1.322,0.771,2.203,1.211,3.635,1.211c2.751,0,5.173-2.203,5.173-5.286C139.055,140.961,137.845,139.75,135.752,138.429z"
      },
      "steam"      : {
        "url"  : "http://steamcommunity.com/profiles/<%= user %>",
        "color": "black",
        "path" : "M149.252,130.782c0,10.197-8.272,18.469-18.47,18.469H69.219c-10.198,0-18.47-8.272-18.47-18.469v-9.812l11.03,4.425c1.668,7.76,8.594,13.596,16.802,13.596c8.979,0,16.353-6.862,17.187-15.583l22.124-16.161c12.826,0,23.151-10.389,23.151-23.086c0-12.826-10.325-23.151-23.151-23.151c-12.632,0-22.958,10.261-23.086,22.894l-14.43,20.65c-0.577-0.064-1.155-0.064-1.796-0.064c-3.206,0-6.221,0.833-8.785,2.372l-19.047-7.631V69.218c0-10.197,8.272-18.469,18.47-18.469h61.563c10.198,0,18.47,8.272,18.47,18.469V130.782z M78.581,134.438c-4.874,0-9.106-2.758-11.223-6.798c2.117,0.834,4.17,1.668,6.285,2.565c5.13,2.052,11.03-0.449,13.147-5.643c2.053-5.131-0.449-11.031-5.643-13.083l-5.259-2.116c0.834-0.193,1.796-0.32,2.694-0.32c7.055,0,12.698,5.643,12.698,12.697C91.279,128.794,85.636,134.438,78.581,134.438z M117.892,99.615c-8.528,0-15.455-6.926-15.455-15.455c0-8.594,6.927-15.52,15.455-15.52c8.594,0,15.519,6.926,15.519,15.52C133.411,92.689,126.485,99.615,117.892,99.615z M117.956,71.655c-6.798,0-12.377,5.579-12.377,12.377c0,6.862,5.579,12.377,12.377,12.377c6.862,0,12.442-5.515,12.442-12.377C130.398,77.234,124.817,71.655,117.956,71.655z"
      },
      "tumblr"     : {
        "url"  : "http://<%= user %>.tumblr.com",
        "color": "#35465c",
        "path" : "M127.257,154.152c-2.176,3.265-12.043,6.965-20.894,7.11c-26.335,0.436-36.275-18.718-36.275-32.212V89.583H57.9V73.985c18.283-6.602,22.708-23.144,23.724-32.575c0.072-0.58,0.58-0.87,0.87-0.87c0,0,0.291,0,17.702,0V71.3h24.159v18.283h-24.232v37.581c0,5.079,1.886,12.116,11.608,11.898c3.192-0.072,7.473-1.016,9.721-2.104L127.257,154.152z"
      },
      "twitter"    : {
        "url"  : "https://twitter.com/<%= user %>",
        "color": "#55acee",
        "path" : "M142.456,82.932c0.065,0.917,0.065,1.835,0.065,2.752c0,27.977-21.293,60.212-60.212,60.212c-11.99,0-23.128-3.473-32.498-9.5c1.704,0.197,3.342,0.262,5.111,0.262c9.894,0,19.001-3.341,26.273-9.041c-9.304-0.197-17.1-6.29-19.787-14.676c1.311,0.196,2.621,0.327,3.997,0.327c1.9,0,3.801-0.262,5.569-0.721c-9.696-1.966-16.97-10.483-16.97-20.769c0-0.066,0-0.197,0-0.262c2.817,1.572,6.094,2.555,9.566,2.686c-5.7-3.8-9.434-10.286-9.434-17.625c0-3.93,1.048-7.534,2.883-10.679c10.418,12.842,26.077,21.228,43.636,22.145c-0.328-1.573-0.525-3.211-0.525-4.849c0-11.662,9.435-21.163,21.163-21.163c6.093,0,11.597,2.555,15.463,6.683c4.782-0.917,9.369-2.687,13.431-5.111c-1.572,4.914-4.914,9.042-9.304,11.662c4.259-0.459,8.386-1.638,12.187-3.276C150.188,76.184,146.584,79.919,142.456,82.932z"
      },
      "vimeo"      : {
        "url"  : "https://vimeo.com/<%= user %>",
        "color": "#1ab7ea",
        "path" : "M152.095,66.483c-4.193-5.321-12.993-5.525-19.133-4.605c-4.912,0.82-21.693,8.186-27.318,25.888c10.026-0.82,15.348,0.715,14.323,11.767c-0.408,4.707-2.763,9.721-5.32,14.632c-3.069,5.628-8.697,16.679-16.166,8.697c-6.651-7.163-6.243-20.873-7.675-29.98c-0.92-5.116-1.84-11.461-3.479-16.782c-1.433-4.502-4.808-9.925-8.799-11.152c-4.4-1.229-9.822,0.716-12.995,2.558c-10.026,5.934-16.679,14.325-26.5,21.282v0.716c3.276,1.638,2.251,4.298,4.81,4.707c6.036,0.818,11.767-5.627,15.756,1.125c2.457,4.094,3.174,8.595,4.708,12.995c2.149,5.934,3.683,12.381,5.422,19.135c2.865,11.561,6.345,28.752,16.373,32.947c5.014,2.149,12.687-0.716,16.472-3.069c10.438-6.139,18.725-15.042,25.58-24.251c16.067-21.487,24.764-46.044,26.092-53.105C155.167,75.18,155.062,70.268,152.095,66.483z"
      },
      "vine"       : {
        "url"  : "http://",
        "color": "#00b488",
        "path" : "M149.005,118.081c-4.806,1.099-9.611,1.579-13.593,1.579c-9.611,20.182-26.842,37.482-32.609,40.709c-3.639,2.059-7.072,2.197-11.121-0.206c-7.07-4.257-33.843-26.224-42.769-95.285h19.428c4.874,41.464,16.82,62.745,29.932,78.672c7.275-7.277,14.279-16.957,19.702-27.872c-12.975-6.59-20.87-21.075-20.87-37.962c0-17.094,9.817-30,26.636-30c16.338,0,25.263,10.16,25.263,27.665c0,6.522-1.373,13.936-3.983,19.634c0,0-12.081,2.403-16.545-5.355c0.893-2.952,2.129-8.032,2.129-12.632c0-8.169-2.952-12.151-7.414-12.151c-4.737,0-8.033,4.463-8.033,13.044c0,17.505,11.121,27.528,25.537,27.528c2.541,0,5.425-0.275,8.308-0.961V118.081z"
      }
    };

    $.extend(true, socialNodeConfig.accounts, icons);
    var accounts = socialNodeConfig.accounts;
    for (var service in accounts) {
      if (!accounts[service].user || accounts[service].user === '') {
        delete accounts[service];
      } else {
        accounts[service].url = _.template(accounts[service].url)(accounts[service]);
        accounts[service].radius = {min: socialNodeConfig.radius, max: socialNodeConfig.radius * 1.5, cur: socialNodeConfig.radius};
      }
    }
    socialWidget(socialNodeConfig);
  };

  var socialWidget = function (data) {
    var playPop, iconGroupTransform, nodeData, force, container, svg, node, circle, icon, scaleX, scaleY, scaleR;

    var tick = function (e) {

      circle.each(function (d) {
        collide(.5)(d);
        d.x = scaleX(Math.max(d.radius.cur, Math.min(data.width - d.radius.cur, scaleX.invert(d.x))));
        d.y = scaleY(Math.max(d.radius.cur, Math.min(data.height - d.radius.cur, scaleY.invert(d.y))));
        d3.select(this.parentNode).attr('transform', 'translate(' + d.x + ',' + d.y + ')');
      });

    };

    var collide = function (alpha) {
      var quadtree = d3.geom.quadtree(nodeData);
      return function (d) {
        var r = scaleR(d.radius.cur + data.radius + data.padding);
        var nx1 = d.x - r;
        var nx2 = d.x + r;
        var ny1 = d.y - r;
        var ny2 = d.y + r;
        quadtree.visit(function (quad, x1, y1, x2, y2) {
          if (quad.point && (quad.point !== d)) {
            var x = d.x - quad.point.x;
            var y = d.y - quad.point.y;
            var l = Math.sqrt(x * x + y * y);
            var r = scaleR(d.radius.cur + quad.point.radius.cur + data.padding);
            if (l < r) {
              l = (l - r) / l * alpha;
              x *= l;
              y *= l;
              d.x -= x;
              d.y -= y;
              quad.point.x += x;
              quad.point.y += y;
            }
          }
          return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
        });
      };
    };

    var initializeAudio = function () {
      try {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        var context = new AudioContext();
        var loadPop = function () {
          var path = $('#social-nodes-audio').data('wav');
          var req = new XMLHttpRequest();
          req.open('GET', path, true);
          req.responseType = 'arraybuffer';
          req.onload = function () {
            context.decodeAudioData(req.response, function (buf) {
              playPop = function () {
                var src = context.createBufferSource();
                src.buffer = buf;
                src.connect(context.destination);
                src.start();
              };
            });
          };
          req.send();
        };
        loadPop();
      } catch (e) {
        console.log(e);
        playPop = undefined;
      }
    };

    var responsive = function () {
      var newWidth = parseInt(container.style('width'));
      var newHeight = data.height/ data.width * newWidth;
      scaleX.range([0, newWidth]);
      scaleY.range([0, newHeight]);
      svg.attr('width', newWidth).attr('height', newHeight);
      node.each(function (d) {
        resize.call(this, d, true);
      });
      force.size([newWidth, newHeight]).start();
    };

    var resize = function (d, smooth) {
      d3.select(this).select('circle').transition().duration(smooth ? 75 : 750).ease(smooth ? 'cubic-in-out' : 'elastic').attr('r', scaleR(d.radius.cur));
      d3.select(this).select('.social-node-icon').transition().duration(smooth ? 75 : 750).ease(smooth ? 'cubic-in-out' : 'elastic').attr('transform', iconGroupTransform({cur: scaleR(d.radius.cur)}));
    };

    var onMouseEnter = function (d) {
      force.start();
      d.radius.cur = d.radius.max;
      resize.call(this, d);
      if (playPop) {
        playPop()
      }
    };

    var onMouseLeave = function (d) {
      force.start();
      d.radius.cur = d.radius.min;
      resize.call(this, d);
    };

    scaleR = function (n) {
      if (Math.max.apply(null, scaleX.range()) <= Math.max.apply(null, scaleY.range())) {
        return scaleX(n);
      } else {
        return scaleY(n);
      }
    };

    iconGroupTransform = _.template('translate(-<%= cur %>,-<%= cur %>),scale(<% print(cur/100); %>)');

    if (data.sound) {
      initializeAudio();
    }

    nodeData = [];

    for (var key in data.accounts) {
      data.accounts[key].service = key;
      nodeData.push(data.accounts[key]);
    }

    container = d3.select('#social-nodes');

    if (!container) return;

    var contWidth = parseInt(container.style('width'));
    var contHeight = parseInt(container.style('height'));
    if (contHeight < data.height) contHeight = data.height;

    scaleX = d3.scale.linear().domain([0, data.width]).range([0, contWidth]);
    scaleY = d3.scale.linear().domain([0, data.height]).range([0, contHeight]);

    svg = container.append("svg").attr({
          width : contWidth,
          height: contHeight,
          class : 'social'
        });

    force = d3.layout.force().nodes(nodeData).size([contWidth, contHeight]).charge(data.charge).gravity(data.gravity).on("tick", tick).start();

    node = svg.selectAll("g").data(nodeData, function (d) {
          return d.url;
        });

    node.enter().append('g').attr('class', function (d) {
          return 'social-node ' + d.service;
        }).call(force.drag);

    circle = node.selectAll('circle');

    if (circle.empty()) {
      circle = node.append('circle').attr('class', 'social-node-circle').attr('fill', function (d) {
            return data.invert ? data.baseColor : d.color;
          });
    }

    icon = node.selectAll('.social-node-icon');

    if (icon.empty()) {
      icon = node.append('g').attr({
            'transform': function (d) { return iconGroupTransform({cur: 0}); },
            'class'    : 'social-node-icon'
          });

      icon.append('path').attr({'d': function (d) {return d.path;},
            'fill'                 : function (d) { return data.invert ? d.color : 'white'}});

      icon.filter(function (d) { return d.service === 'flickr'; }).selectAll('.subcircle').data(function (d) { return d.circles; }).enter().append('path').attr({
            'd'    : function (d) { return d.path; },
            'fill' : function (d) { return data.invert ? d.inverted : d.color; },
            'class': 'subcircle'
          });
    }

    circle.transition().duration(750).delay(function (d, i) { return i * 75; }).attrTween("r", function (d) {
          var i = d3.interpolate(0, d.radius.cur);
          return function (tk) {
            d.radius.cur = i(tk);
            return scaleR(d.radius.cur);
          };
        });

    icon.transition().duration(750).delay(function (d, i) { return i * 75; }).attrTween('transform', function (d) {
          var i = d3.interpolate(iconGroupTransform({cur: 0}), iconGroupTransform({cur: scaleR(d.radius.cur)}));
          return function (t) {
            return i(t);
          };
        });

    node
        .on('mouseenter', onMouseEnter)
        .on('mouseleave', onMouseLeave)
        .on('click', function (d) {
          if (!d3.event.defaultPrevented) {
            window.open(d.url, '_blank');
          }
        });

    d3.select(window).on('resize', responsive);
  };
  init();
});
